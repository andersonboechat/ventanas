<?xml version="1.0" encoding="ISO-8859-1"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:form id="bookings-form">
		<p:dataTable widgetVar="bookingTable" var="booking" value="#{historyViewer.bookings}"	paginator="true" paginatorPosition="bottom" 
			paginatorTemplate="{PreviousPageLink} {NextPageLink}" rows="5" rowKey="#{booking.id}" 
			emptyMessage="Nenhum aluguel encontrado" styleClass="no-header no-border no-background" style="margin-top: 15px; width: 378px; height: 100%">
		    <p:ajax event="page" global="false"/>
			<f:facet name="header">
				<p:panelGrid columns="1" columnClasses="docs-header" styleClass="no-border no-margin no-background" style="width: 100%; height: 25px">
					<h:outputText value="#{msg['my.bookings.header']}"/>
				</p:panelGrid>
			</f:facet>
			<p:column style="width: 20px; vertical-align: top">
				<p:panel styleClass="no-border #{historyViewer.getBookingStyle(booking)}" style="width: 30px; height: 30px; "/>
			</p:column>
			<p:column style="vertical-align: top;">
				<p:panelGrid columns="1" styleClass="no-margin no-border no-background">
					<h:outputText value="#{booking.resource.name}" style="font-size: 14px; color: black; font-weight: bold;"/>
					<h:outputText value="#{booking.beginDate}" style="font-size: 12px;">
						<f:convertDateTime pattern="EEEE, dd 'de' MMMM 'de' yyyy"/>
					</h:outputText>
					<p:panelGrid columns="2" styleClass="no-background no-border" style="font-size: 12px; width: 130px;">
						<h:outputText value="#{booking.beginDate}">
							<f:convertDateTime pattern="'das' HH:mm'h'"/>
						</h:outputText>
						<h:outputText value="#{booking.endDate}">
							<f:convertDateTime pattern="'às' HH:mm'h'"/>
						</h:outputText>
					</p:panelGrid>
				</p:panelGrid>
			</p:column>
			<p:column style="width: 35px">
				<p:commandLink title="#{msg['this.book.cancel']}" actionListener="#{historyViewer.onCancel(booking)}" partialSubmit="true" 
					process="@this" update="@widgetVar(bookingTable),@widgetVar(tabs),@widgetVar(outputMsg)" disabled="#{not historyViewer.isCancelEnabled(booking)}" rendered="#{historyViewer.hasDeadlineExceeded(booking)}">
					<h:graphicImage value="../images/cancel2.png" />
					<p:confirm header="#{msg['booking.cancel.header']}" message="#{msg['register.cancel.deadline']}" icon="ui-icon-alert"/>
				</p:commandLink>
				<p:commandLink title="#{msg['this.book.cancel']}" actionListener="#{historyViewer.onCancel(booking)}" partialSubmit="true" 
					process="@this" update="@widgetVar(bookingTable),@widgetVar(tabs),@widgetVar(outputMsg)" disabled="#{not historyViewer.isCancelEnabled(booking)}" rendered="#{not historyViewer.hasDeadlineExceeded(booking)}">
					<h:graphicImage value="../images/cancel2.png" />
					<p:confirm header="#{msg['booking.cancel.header']}" message="#{msg['booking.cancel.confirm']}" icon="ui-icon-alert"/>
				</p:commandLink>
			</p:column>
		</p:dataTable>
	</h:form>
</f:view>