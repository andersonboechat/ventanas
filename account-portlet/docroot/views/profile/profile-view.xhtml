<?xml version="1.0" encoding="ISO-8859-1"?>

<f:view
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<p:growl id="outputMsg"/>
	<f:loadBundle basename="Language_pt_BR" var="msg"/>
	<c:set var="profilePictureUploader" value="#{profileBean.imageUploadBean}"/>

	<h:form id="profile-form">	
		<p:panelGrid id="person-details" columns="2" columnClasses="my-account-col1,my-account-col2" styleClass="no-border" style="margin: 10px 0px 20px 0px;" cellpadding="10">
			<p:column>
				<p:panelGrid columns="1" columnClasses="person-image" style="text-align: center">
					<p:graphicImage id="portrait" value="#{profilePictureUploader.image.path}" width="198" height="300"/>
		        </p:panelGrid>
				<p:panelGrid columns="2" columnClasses="no-margin" style="text-align: center; width: 100%;">
					<p:commandLink value="Enviar Foto" update=":tabs:profile-picture-form" oncomplete="PF('profilePictureDialog').show();" partialSubmit="true" process="@this" styleClass="column">
						<f:setPropertyActionListener target="#{profilePictureUploader.image.path}" value=""/>
					</p:commandLink>
					<p:commandLink value="Tirar Foto" update=":tabs:profile-picture-form" oncomplete="PF('profilePictureDialog').show();" partialSubmit="true" process="@this" styleClass="column">
						<f:setPropertyActionListener target="#{profilePictureUploader.image.path}" value=""/>
					</p:commandLink>
				</p:panelGrid>
			</p:column>
			<p:column>
				<p:panelGrid columns="1" columnClasses="fieldClm">
					<p:panelGrid columns="2" columnClasses="labelClm,fieldClm" style="width: 100%; margin: 0px">
						<p:outputLabel for="email" value="Email: "/>
						<p:inputText id="email" value="#{profileBean.person.emailAddress}" size="40"/>
						<p:outputLabel for="firstName" value="Nome: "/>
						<p:inputText id="firstName" value="#{profileBean.person.firstName}" size="40"/>
						<p:outputLabel for="lastName" value="Sobrenome: "/>
						<p:inputText id="lastName" value="#{profileBean.person.lastName}" size="40"/>
						<p:outputLabel for="identity" value="CPF: "/>
						<p:inputMask id="identity" value="#{profileBean.person.identity}" mask="999.999.999-99" size="40"/>
						<p:outputLabel for="male" value="Sexo:"/>
						<p:selectOneMenu id="male" value="#{profileBean.person.gender}" required="false">
							<f:selectItems var="gender" value="#{profileBean.genders}" itemLabel="#{msg[gender.label]}"/>
						</p:selectOneMenu>
					</p:panelGrid>
				</p:panelGrid>
			</p:column>
		</p:panelGrid>
		<p:commandButton value="Cancelar" update="profile-form" style="float: right; width: 80px; margin: 0px 0px 10px 5px;"/>
		<p:commandButton value="Salvar" actionListener="#{profileBean.onSave}" update=":outputMsg" style="float: right; width: 80px; margin: 0px 0px 10px 5px;"/>
	</h:form>

	<p:dialog id="profilePictureDialog" widgetVar="profilePictureDialog" modal="true" header="Retrato">
		<h:form id="profile-picture-form" enctype="multipart/form-data">
			<p:fileUpload id="image" label="Selecionar Foto" fileUploadListener="#{profilePictureUploader.onImageUpload}" auto="true" update="profile-picture-form" rendered="#{empty profilePictureUploader.image.path}"/>
			<p:panel rendered="#{!(empty profilePictureUploader.image.path)}" style="border: 0px !important;">
				<p:panel styleClass="cropper">
					<p:imageCropper value="#{profilePictureUploader.croppedImage}" image="#{profilePictureUploader.image.path}" initialCoords="0,0,#{profilePictureUploader.width},#{profilePictureUploader.height}" minSize="#{profilePictureUploader.width},#{profilePictureUploader.height}" maxSize="#{profilePictureUploader.width},#{profilePictureUploader.height}"/>
				</p:panel>
				<p:panel style="margin: 0px auto; text-align: center; padding: 15px 0px; border: none;">
					<p:commandButton value="Recortar" actionListener="#{profilePictureUploader.onImageCropp}" update=":profile-form:portrait" oncomplete="PF('profilePictureDialog').hide();"/>
					<p:commandButton value="Cancelar" oncomplete="PF('personPictureDialog').hide();" partialSubmit="true" process="@this">
						<f:setPropertyActionListener target="#{profilePictureUploader.image.path}" value=""/>
					</p:commandButton>
				</p:panel>
			</p:panel>
		</h:form>
	</p:dialog>
</f:view>
