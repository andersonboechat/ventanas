<?xml version="1.0" encoding="ISO-8859-1"?>

<f:view
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:form id="vehicle-form">
		<p:panelGrid columns="2" styleClass="no-border person-cmds" columnClasses="person-cmds-left,person-cmds-right">
			<p:inputText id="license" value="#{vehicleViewer.license}" placeholder="Buscar pela placa" style="font-style: italic; width: 100%">
				<p:ajax event="change" listener="#{vehicleViewer.onVehicleSearch}" update="vehicleTable" partialSubmit="true" process="@this"/>
			</p:inputText>

			<p:commandButton value="Cadastrar um veículo" actionListener="#{vehicleViewer.onVehicleCreate}" 
							 partialSubmit="true" process="@this" update=":tabs:vehicle-details-form" oncomplete="PF('vehicleDialog').show();"
							 style="font-size: 12px" global="false"/>
		</p:panelGrid>
		<p:dataGrid id="vehicleTable" widgetVar="vehicleTable" var="vehicle" value="#{vehicleViewer.model}" 
					columns="4" layout="grid" paginator="false" emptyMessage="Nenhum veículo cadastrado" 
					styleClass="no-border no-header">
	        <p:panel header="#{msg[vehicle.type.label]}" styleClass="vehicle-box">
	            <h:panelGrid columns="1" style="width:100%">
			        <p:graphicImage value="#{vehicle.image.path}" styleClass="foto car-image" style="background-size: 100px 90px; margin-bottom: 0px" width="100" height="90" rendered="#{vehicle.type == 'CAR'}"/>
			        <p:graphicImage value="#{vehicle.image.path}" styleClass="foto moto-image" style="background-size: 100px 90px; margin-bottom: 0px" width="100" height="90" rendered="#{vehicle.type == 'MOTO'}"/>
			        <p:graphicImage value="#{vehicle.image.path}" styleClass="foto bike-image" style="background-size: 100px 90px; margin-bottom: 0px" width="100" height="90" rendered="#{vehicle.type == 'BIKE'}"/>
					<p:outputLabel value="#{vehicle.license} - #{msg[vehicleViewer.displayLabel(vehicle)]}" rendered="#{vehicle.type != 'BIKE'}"/>
					<p:outputLabel value="#{vehicle.license}" rendered="#{vehicle.type == 'BIKE'}"/>

	 				<h:panelGrid columns="2" style="width:100%;">
						<p:commandLink update=":tabs:vehicle-details-form" 
									   actionListener="#{vehicleViewer.onVehicleEdit}" oncomplete="PF('vehicleDialog').show();" 
									   partialSubmit="true" process="@this" title="Alterar dados deste veículo">
							<h:graphicImage value="../images/edit.png" style="float: right; margin-right: 5px;"/>
						</p:commandLink>
						<p:commandLink actionListener="#{vehicleViewer.onVehicleDelete}" update="vehicleTable,:outputMsg" 
									   partialSubmit="true" process="@this" title="Excluir este veículo">
							<h:graphicImage value="../images/cancel2.png" style="float: left; margin-left: 5px;" />
							<p:confirm header="Exclusão de veículo" message="Você confirma a exclusão do veículo, deste apartamento?" icon="ui-icon-alert"/>
						</p:commandLink>
					</h:panelGrid>
	            </h:panelGrid>
	        </p:panel>
	    </p:dataGrid>
		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade" visible="false" closable="false"
						  style="padding: 0px; font-size: 13px;">
			<p:panel style="width: 220px; margin: 0 auto;" styleClass="no-border no-background">
				<p:commandButton value="#{msg['no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="float: right; width: 85px;" />
				<p:commandButton value="#{msg['yes']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" style="width: 85px;"/>
			</p:panel>
		</p:confirmDialog>
	</h:form>

	<h:form id="vehicle-details-form" enctype="multipart/form-data">
		<p:dialog widgetVar="vehicleDialog" draggable="false" resizable="false" modal="true" 
				 visible="false" closable="false" style="background: #f9f9f9">
			<f:facet name="header">
				<p:graphicImage value="../images/picture_ico.png" style="vertical-align: top; margin-right: 10px;"/>
				<p:outputLabel value="Cadastro de Veículo" style="vertical-align: top; line-height: 20px"/>
			</f:facet>			
			<p:panelGrid id="vehicle-details" columns="1" styleClass="no-border no-background" style="width: 100%;">
				<p:panel id="portrait" styleClass="no-border no-margin no-background">
					<p:graphicImage value="#{vehicleViewer.vehicle.image.path}" styleClass="foto" width="364" height="300" rendered="#{vehicleViewer.vehicle.type == null}"/>
			        <p:graphicImage value="#{vehicleViewer.vehicle.image.path}" styleClass="foto car-image" width="364" height="300" rendered="#{vehicleViewer.vehicle.type == 'CAR'}"/>
			        <p:graphicImage value="#{vehicleViewer.vehicle.image.path}" styleClass="foto moto-image" width="364" height="300" rendered="#{vehicleViewer.vehicle.type == 'MOTO'}"/>
			        <p:graphicImage value="#{vehicleViewer.vehicle.image.path}" styleClass="foto bike-image" width="364" height="300" rendered="#{vehicleViewer.vehicle.type == 'BIKE'}"/>
				</p:panel>
				<p:panelGrid columns="3" styleClass="no-border no-background" style="width: 100%;">
					<p:selectOneMenu widgetVar="vehicleType" id="vehicleType" value="#{vehicleViewer.vehicle.type}" required="true" 
									 requiredMessage="Selecione o tipo do veículo" style="width: 115px; float: left; margin-left: 5px;">
						<f:selectItem itemLabel="Tipo" noSelectionOption="true"/>
						<f:selectItems var="type" value="#{vehicleViewer.types}" itemValue="#{type}" itemLabel="#{msg[type.label]}"/>
						<p:ajax event="change" update="vehicle-details" global="false"/>
					</p:selectOneMenu>
			    	<p:inputMask widgetVar="license" id="license" mask="aaa?-9999" value="#{vehicleViewer.vehicle.license}" 
			    				 style="width: 120px; text-transform: uppercase;" readonly="#{vehicleViewer.vehicle.id > 0}" 
			    				 rendered="#{vehicleViewer.vehicle.type != 'BIKE'}" required="true" requiredMessage="Informe a placa do veículo"
			    				 placeholder="Placa"/>
			        <p:inputText id="serial" value="#{vehicleViewer.vehicle.license}" maxlength="15" 
			        			 style="width: 120px; text-transform: uppercase;" placeholder="Número de Serie" 
			        			 readonly="#{vehicleViewer.vehicle.id > 0}" rendered="#{vehicleViewer.vehicle.type == 'BIKE'}"/>
					<p:commandLink title="Enviar foto" update="@widgetVar(tabs:vehicle-picture-form)" oncomplete="PF('vehiclePictureDialog').show();" 
								   partialSubmit="true" process="@this" style="float: right; margin-right: 5px; padding:0;">
						<h:graphicImage value="../images/send-pic.png" styleClass="no-margin"/>
						<f:setPropertyActionListener target="#{vehicleViewer.vehicle.image.path}" value=""/>
					</p:commandLink>
				</p:panelGrid>
				<p:column>
					<p:commandButton value="Cancelar" type="button" onclick="PF('vehicleDialog').hide();" 
									 style="float: right; width: 90px; margin: 5px 12px 10px 0px;" global="false"/>
					<p:commandButton value="Salvar" oncomplete="if (!args.validationFailed) {PF('confirmData').show();}"
									 style="float: right; width: 90px; margin: 5px 12px 10px 0px;" update=":outputMsg"/>
				</p:column>
			</p:panelGrid>
		</p:dialog>
		<p:confirmDialog id="confirmData" widgetVar="confirmData" message="Os dados abaixo estão corretos?" header="Confirmação de dados" 
						 severity="alert" showEffect="fade" hideEffect="fade" style="background: #f9f9f9">
			<p:outputPanel autoUpdate="true" style="text-align: center">
				<p:panelGrid columns="2" styleClass="no-border no-background" style="margin: 0 auto;">
					<h:outputText value="Veículo:" rendered="#{vehicleViewer.vehicle.type != null}"/>
					<h:outputText value="#{msg[vehicleViewer.vehicle.type.label]}" rendered="#{vehicleViewer.vehicle.type != null}"/>
					<h:outputText value="Placa:" rendered="#{vehicleViewer.vehicle.type != 'BIKE'}"/>
					<h:outputText value="Número de Serie:" rendered="#{vehicleViewer.vehicle.type == 'BIKE'}"/>
					<h:outputText value="#{vehicleViewer.vehicle.license}" style="text-transform: uppercase;"/>
				</p:panelGrid>
			</p:outputPanel>
			<p:panel style="text-align: center; border: 0px solid black; width: 200px; margin: 0 auto;" styleClass="no-background">
				<p:commandButton value="#{msg['no']}" type="button" onclick="PF('confirmData').hide();" icon="ui-icon-close" style=" float:right;"/>
				<p:commandButton value="#{msg['yes']}" actionListener="#{vehicleViewer.onVehicleSave}" update="@widgetVar(parkingTable),@widgetVar(vehicleTable),:outputMsg" 
								 oncomplete="PF('confirmData').hide(); if (!args.validationFailed) { if(!args.exception) {PF('vehicleDialog').hide();} else { if(args.alert) {PF('alertDialog').show();}}}" 
								 icon="ui-icon-check" style="margin-left: 5px;"/>
			</p:panel>
		</p:confirmDialog>
		<p:confirmDialog header="Veículo encontrado" widgetVar="alertDialog" showEffect="fade" hideEffect="fade" 
						 styleClass="alert no-margin" closable="false" width="300px">
			<f:facet name="message">
				<p:messages id="alertMsg" severity="warn" autoUpdate="true" styleClass="no-background no-margin" style="text-align: justify; margin: 0;"/>
			</f:facet>
			<p:panel styleClass="no-background no-border" style="text-align: center; width: 200px; margin: 0 auto;">
				<p:commandButton value="#{msg['no']}" type="button" onclick="PF('alertDialog').hide();" icon="ui-icon-close" style=" float:right;"/>
				<p:commandButton value="#{msg['yes']}" actionListener="#{vehicleViewer.onVehicleClaim}" update=":outputMsg"	oncomplete="PF('alertDialog').hide(); PF('vehicleDialog').hide();" icon="ui-icon-check" style="margin-left: 5px;"/>
			</p:panel>
		</p:confirmDialog>
	</h:form>
	
	<p:dialog id="vehiclePictureDialog" widgetVar="vehiclePictureDialog" modal="true" resizable="false" style="background: #f9f9f9">
		<f:facet name="header">
			<p:graphicImage value="../images/picture_ico.png" style="vertical-align: top; margin-right: 10px;"/>
			<p:outputLabel value="Envio de Foto" style="vertical-align: top; line-height: 22px"/>
		</f:facet>			
		<h:form id="vehicle-picture-form" enctype="multipart/form-data">
			<p:fileUpload id="image" label="Selecionar Foto" fileUploadListener="#{vehiclePictureUploader.onImageUpload}" 
						  mode="advanced" auto="true" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" update="vehicle-picture-form" 
						  rendered="#{empty vehiclePictureUploader.image.path}"/>
			<p:panel rendered="#{!(empty vehiclePictureUploader.image.path)}" style="border: 0px !important;" styleClass="no-background">
				<p:panel styleClass="cropper2 no-background">
					<p:imageCropper value="#{vehiclePictureUploader.croppedImage}" image="#{vehiclePictureUploader.image.path}" initialCoords="0,0,#{vehiclePictureUploader.width},#{vehiclePictureUploader.height}" minSize="#{vehiclePictureUploader.width},#{vehiclePictureUploader.height}" maxSize="#{vehiclePictureUploader.width},#{vehiclePictureUploader.height}"/>
				</p:panel>
				<p:panel styleClass="no-background" style="margin: 0px auto; text-align: center; padding: 15px 0px; border: none;">
					<p:commandButton value="Recortar" actionListener="#{vehiclePictureUploader.onImageCropp}" update=":tabs:vehicle-details-form:portrait" oncomplete="PF('vehiclePictureDialog').hide();"/>
					<p:commandButton value="Cancelar" oncomplete="PF('vehiclePictureDialog').hide();" partialSubmit="true" process="@this">
						<f:setPropertyActionListener target="#{vehiclePictureUploader.image.path}" value=""/>
					</p:commandButton>
				</p:panel>
			</p:panel>
		</h:form>
	</p:dialog>
</f:view>
