<?xml version="1.0" encoding="ISO-8859-1"?>

<f:view
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head></h:head>
<ui:composition template="main-template.xhtml">
	<ui:define name="app-view">
		<p:dialog id="registerCompleteDialog" widgetVar="registerCompleteDialog" modal="true" closable="false" 
				  resizable="false" draggable="false" visible="#{not managerBean.person.registerComplete}"
				  width="430" height="300">
			<f:facet name="header">
				<p:graphicImage value="../images/user_ico.png" style="vertical-align: top; margin-right: 10px;"/>
				<p:outputLabel value="Primeiro acesso" style="vertical-align: top; line-height: 25px;"/>
			</f:facet>
			<h:form id="register-complete-form">
				<p:wizard id="wiz" widgetVar="wiz" backLabel="Voltar" nextLabel="Avançar" showStepStatus="false" showNavBar="false" style="margin: 0px">
					<p:tab id="welcome">
						<p:panelGrid columns="1" styleClass="no-border no-background no-margin" style="width: 100%; height: 100%;">
							<p:panel styleClass="no-border" style="width: 100%; height: 230px;">
								<p>Prezado morador, seja bem vindo.</p>
								<p style="text-align: justify;">
								Algumas informações do seu cadastro ou do cadastro dos seus apartamentos estão incompletas ou precisam ser revisadas.
								Por favor, clique no botão Iniciar para concluir esse processo e ter acesso a todos os serviços de nosso portal.
								</p>
								<p>Obrigado.</p>
								<p style="text-align: right;">Administração</p>
							</p:panel>
							<p:commandButton value="#{msg.start}" type="button" onclick="PF('wiz').next();" style="float: right; padding: 2px; width: 90px; margin: 10px 10px 0px;"/>
						</p:panelGrid>	
					</p:tab>
					<p:tab id="person-details" title="Informações Pessoais">
						<p:panelGrid columns="1" styleClass="no-border no-background no-margin" style="width: 100%; height: 100%;">
						<p:panel styleClass="no-border" style="width: 100%; text-align: center; font-size: 16px;">Informações Pessoais</p:panel>
						<p:panelGrid columns="2" columnClasses="labelClm,fieldClm" styleClass="userPanel no-border no-background" style="width: 100%; height: 191px;">
							<p:column styleClass="labelClm"><p:outputLabel for="firstName" value="Nome: "/></p:column>
							<p:column styleClass="fieldClm">
								<p:inputText id="firstName" value="#{managerBean.person.firstName}" required="true" lang="pt" 
											 requiredMessage="#{msg['person.firstname.empty']}" validatorMessage="O nome deve conter somente letras">
	       							<f:validateRegex pattern="^([\s]*\p{L}[\s]*)+$" />
								</p:inputText>
							</p:column>
							<p:column styleClass="labelClm"><p:outputLabel for="lastName" value="Sobrenome: "/></p:column>
							<p:column styleClass="fieldClm">
								<p:inputText id="lastName" value="#{managerBean.person.lastName}" required="true" 
											 requiredMessage="#{msg['person.lastname.empty']}"
											 validatorMessage="O sobrenome deve conter somente letras">
	       							<f:validateRegex pattern="^([\s]*\p{L}[\s]*)+$" />
								</p:inputText>
							</p:column>
							<p:column styleClass="labelClm"><p:outputLabel for="identity" value="CPF: "/></p:column>
							<p:column styleClass="fieldClm">
								<p:inputMask id="identity" value="#{managerBean.person.identity}" mask="999.999.999-99" 
											 required="true" requiredMessage="#{msg['person.identity.empty']}" />
							</p:column>
							<p:column styleClass="labelClm"><p:outputLabel for="male" value="Sexo:"/></p:column>
							<p:column>
								<p:selectOneMenu id="male" value="#{managerBean.person.gender}" required="true" 
												 requiredMessage="#{msg['person.gender.empty']}" style="vertical-align: middle">
									<f:selectItem itemLabel="Selecione" noSelectionOption="true"/>
									<f:selectItems var="gender" value="#{managerBean.genders}" itemLabel="#{msg[gender.label]}"/>
								</p:selectOneMenu>
							</p:column>
							<p:column styleClass="labelClm"><p:outputLabel for="birthday" value="Nascimento:"/></p:column>
							<p:column styleClass="fieldClm">
								<p:calendar id="birthday" mode="popup" pattern="dd/MM/yyyy" value="#{managerBean.person.birthday}"
											navigator="true" yearRange="c-100:c+0" styleClass="birthday" mask="true" locale="pt" 
											requiredMessage="A data de nascimento deve ser informada" required="true"/>
							</p:column>
						</p:panelGrid>
						<p:column>
							<p:commandButton value="#{msg.forward}" actionListener="#{managerBean.onSavePerson}" 
											 update=":outputMsg" rendered="#{not empty managerBean.flats}" 
											 oncomplete="if (!args.validationFailed &amp;&amp; !args.exception) {PF('wiz').next();}" 
											 style="float: right; padding: 2px; width: 90px; margin: 10px 10px 0px;"/>
							<p:commandButton value="#{msg.finish}" actionListener="#{managerBean.onFinish}" 
											 update="wiz,:outputMsg" rendered="#{empty managerBean.flats}"
											 oncomplete="if (!args.validationFailed &amp;&amp; !args.exception) {PF('registerCompleteDialog').hide();}" 
											 style="float: right; padding: 2px; width: 90px; margin: 10px 10px 0px;"/>
							<p:commandButton value="Voltar" type="button" onclick="PF('wiz').back();" style="float: right; padding: 2px; width: 85px; margin-right: 8px;" rendered="false"/>
						</p:column>
						</p:panelGrid>
					</p:tab>
					<p:tab id="flat-details" title="Informações sobre o Apartamento">
						<p:panelGrid columns="1" styleClass="no-border no-background no-margin" style="width: 100%; height: 100%;">
							<p:panel styleClass="no-border" style="width: 100%; text-align: center; font-size: 16px;">Apartamento #{managerBean.flat.number} - bloco #{managerBean.flat.block}</p:panel>
							<p:panelGrid id="teste-flat" columns="1" styleClass="no-background no-border no-margin questions" style="width: 100%; height: 191px;">
								<p:outputLabel for="hasPets" value="Existem animais residindo no apartamento?"/>
								<p:selectOneRadio id="hasPets" widgetVar="hasPets" value="#{managerBean.flat.pets}" required="true" 
												  requiredMessage="Informe se existem animais residindo no apartamento." style="margin-left: 5px;">
									<f:selectItem itemLabel="#{msg.yes}" itemValue="true"/>
									<f:selectItem itemLabel="#{msg.no}" itemValue="false"/>
									<p:ajax event="change" listener="#{managerBean.onPetSelect}" update="ptLabel" oncomplete="if (!args.validationFailed) {if ((args.value &amp;&amp; PF('pets').cfg.collapsed) || (!args.value &amp;&amp; !PF('pets').cfg.collapsed) ) {PF('pets').toggle();}}" global="false"/>
								</p:selectOneRadio>
								<p:panel id="pets" widgetVar="pets" toggleable="true" collapsed="#{not managerBean.flat.pets}" styleClass="no-border no-background no-margin">
									<p:panelGrid columns="1" styleClass="no-background no-border">
										<p:outputLabel id="ptLabel" for="petTypes" value="Quais tipos de animais?" style="margin-left: 0px;"/>
										<p:selectManyCheckbox id="petTypes" value="#{managerBean.flat.petTypes}" required="#{managerBean.flat.pets}" requiredMessage="Informe os tipos de animais" converter="jsonConverter">
											<f:selectItems var="type" value="#{managerBean.petTypes}" itemLabel="#{msg[type.label]}" itemValue="#{type}"/>
										</p:selectManyCheckbox>
									</p:panelGrid>
								</p:panel>
								<p:outputLabel for="hasDisables" value="Existem moradores com dificuldade de locomoção?"/>
								<p:selectOneRadio id="hasDisables" value="#{managerBean.flat.disables}" required="true" requiredMessage="Informe se existem moradores com dificuldade de locomoção" style="margin-left: 5px;">
									<f:selectItem itemLabel="#{msg.yes}" itemValue="true"/>
									<f:selectItem itemLabel="#{msg.no}" itemValue="false"/>
								</p:selectOneRadio>
								<p:outputLabel for="hasBrigade" value="Há moradores com treinamento de brigada contra incêndio?"/>
								<p:selectOneRadio id="hasBrigade" value="#{managerBean.flat.brigade}" required="true" requiredMessage="Informe se há moradores com treinamento de brigada contra incêndio" style="margin-left: 5px;">
									<f:selectItem itemLabel="#{msg.yes}" itemValue="true"/>
									<f:selectItem itemLabel="#{msg.no}" itemValue="false"/>
								</p:selectOneRadio>
							</p:panelGrid>
							<p:column>
								<p:commandButton value="#{msg.finish}" actionListener="#{managerBean.onFinish}" 
												 update="wiz,:outputMsg" rendered="#{not(managerBean.hasNextFlat())}"
												 oncomplete="if (!args.validationFailed &amp;&amp; !args.exception) {PF('registerCompleteDialog').hide();}" 
												 style="float: right; padding: 2px; width: 90px; margin: 10px 10px 0px;"/>
								<p:commandButton value="#{msg.forward}" actionListener="#{managerBean.onNext}" 
												 update="wiz,:outputMsg" rendered="#{managerBean.hasNextFlat()}"
												 oncomplete="if (!args.validationFailed) {if ((args.value &amp;&amp; PF('pets').cfg.collapsed) || (!args.value &amp;&amp; !PF('pets').cfg.collapsed)) {PF('pets').toggle();}}"
												 style="float: right; padding: 2px; width: 90px; margin: 10px 10px 0px;"/>
								<p:commandButton value="#{msg.backward}" type="button" onclick="PF('wiz').back();" 
												 rendered="#{not(managerBean.hasPreviousFlat())}"
												 style="float: right; padding: 2px; width: 90px; margin: 10px 5px 0px;"/>
								<p:commandButton value="#{msg.backward}" actionListener="#{managerBean.onPrevious}" 
												 update="wiz,:outputMsg" rendered="#{managerBean.hasPreviousFlat()}" 
												 oncomplete="if (!args.validationFailed) {if ((args.value &amp;&amp; PF('pets').cfg.collapsed) || (!args.value &amp;&amp; !PF('pets').cfg.collapsed)) {PF('pets').toggle();}}"
												 style="float: right; padding: 2px; width: 90px; margin: 10px 5px 0px;"/>
							</p:column>
						</p:panelGrid>
					</p:tab>
				</p:wizard>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>
</f:view>